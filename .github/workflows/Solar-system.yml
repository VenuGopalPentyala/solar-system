name: Solar-System

on:
  workflow_dispatch: 
  push:
    branches: 
      - main
      - 'feature/*'

env:
    MONGO_URI: 'mongodb+srv://supercluster.d83jj.mongodb.net/superData'
    MONGO_USERNAME: superuser
    MONGO_PASSWORD: SuperPassword
jobs:
    unit-testing:
        name: Unit Testing
        # strategy:
        #   matrix:
        #     nodejs-version: [18, 19, 20]
        #     os: [ubuntu-latest, macos-latest]
        #     exclude:
        #       - nodejs-version: 18
        #         os: macos-latest
        
        runs-on: ubuntu-latest
        steps:
          - name: Checkout Repo
            uses: actions/checkout@v4
          
          - name: Setup NodeJs Version - 18
            uses: actions/setup-node@v3
            with:
              node-version: 18

          - name: Install Dependenicies 
            run: npm install

          - name: Unit Tetsing 
            id: npm-test-id
            run: npm test

          - name: Archiving Tets Results
            if: failure() && (steps.npm-test-id.outcome == 'failure' || steps.npm-test-id.outcome == 'success')
            uses: actions/upload-artifact@v2
            with:
                name: mocha-test-results
                path: test-results.xml
    
    code-coverage:
        name: Code Coverage
        runs-on: ubuntu-latest
        steps:
            - name: checkout repository
              uses: actions/checkout@v4

            - name: setup NodeJs Version
              uses: actions/setup-node@v3
              with:
                node-version: 18

            - name: Install dependencies
              run: npm install

            - name: Check code coverage
              run: npm run coverage
              continue-on-error: true

            - name: Archive Test Result
              uses: actions/upload-artifact@v3
              with:
                name: code-coverage-results
                path: coverage
                retention-days: 5